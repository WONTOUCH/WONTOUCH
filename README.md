
# 프로젝트 진행상황 (24.09.25 기준)

## FE

### 회원 관련 기능 - 김태성

- 카카오 로그인
    - 인가코드를 받아서 백엔드에 전송
    - redirect_uri를 http://localhost:3000/auth/kakao 로 설정하여 컴포넌트 호출
- 회원가입
    - 회원가입 폼 퍼블리싱
    - 회원가입 이후에 바로 로그인 될 수 있도록 구현할 예정(Redux에 유저에 대한 정보 담기)

### 게임 맵 제작 - 홍선주

![original_240924_real_finish.png](https://file.notion.so/f/f/d20edc91-68da-4aea-886c-5070ee092079/725289fe-6aff-4460-8815-bb1504301ad4/original_240924_real_finish.png?table=block&id=8b89e921-0fa7-4182-be97-cc8058b231c3&spaceId=d20edc91-68da-4aea-886c-5070ee092079&expirationTimestamp=1727316000000&signature=oFKHQnaHCHdonxnJfubqvjkudoojc5_s0Ns4jto0E4c&downloadName=original_240924_real_finish.png)

- 임시 제작한 마을 맵 정렬 및 추가 제작 & 마무리
- 게임 맵 내 애니메이션 타일 적용
    - Tiled 애니메이션 기능 활용
    - 바다, 강물, 호수, 동물, 기타 작물 및 건물 움직임 구현
- 충돌체 / 마을 & 거래소 상호작용 레이어 생성
- 게임 로비 / 대기방 / 설정 배경 이미지 제작
    
    ![bgAsset.png](https://file.notion.so/f/f/d20edc91-68da-4aea-886c-5070ee092079/e2258ee0-729e-4a7f-9260-b6965d8ee4c8/bgAsset.png?table=block&id=bae58da5-c13b-40a2-b9f6-e219056714d5&spaceId=d20edc91-68da-4aea-886c-5070ee092079&expirationTimestamp=1727316000000&signature=kFBsHRMivE3jjkueYVI4YKsFVTjYwok_rgkcYMwVzA4&downloadName=bgAsset.png)
    
- 프로젝트 초기 세팅 - 폰트, CSS, src 폴더 생성 등

### 게임 진행 중 - 김범규

- 프로젝트 초기설정
- 게임 캐릭터 제작 및 애니메이션 설정
- 페이저와 연동하여 이동 및 걸음 구현까지 종료
- 현재는 맵을 띄워 캐릭터와 충돌 판정 계산하는것 구현중

<br />
<br />



## BE

### 회원 관련 기능 - 우혜지

- **auth 서버**
    - 구글 소셜 로그인 (연결 X)
        - 클라이언트에서 구글 이메일 및 사용자 닉네임 넘겨줄 시 로그인
        - 로그인 후 MySQL user 테이블 내 존재하는 회원인지 확인 후 회원가입 처리
        - 로그인 후 JWT 적용된 access token, refresh token 생성 후 클라이언트 측으로 반환
        - refresh token은 Redis(port:6378)에 userId와 함께 저장
    - 카카오 소셜 로그인 (프론트 연결 완료)
        - 클라이언트에서 카카오 소셜 로그인 후 인가 코드 넘겨줄 시 토큰 발급 + 로그인
        - 로그인 후 MySQL user 테이블 내 존재하는 회원인지 확인 후 회원가입 처리
        - 로그인 후 JWT 적용된 access token, refresh token 생성 후 클라이언트 측으로 반환
        - refresh token은 Redis(port:6378)에 userId와 함께 저장
    - Spring Security 적용
    - JWT 토큰 발급
        - user 테이블에서의 id (`userId`)를 통해 토큰 발급
        - 프론트 측에서 access token을 디코딩하여 userId 조회 가능

- **api 서버**
    - 회원가입 시 닉네임 설정 기능 구현
    - 회원 정보 조회 기능 (구현중)

<br />

### 게임 로비 - 이종민

전반적인 게임 시작 전 로비의 기능을 구현했습니다.

**구현한 기능**

- 환경 설정
- 게임방 생성
- 게임방 입장
- 게임방 퇴장
- 게임방 목록

---

### 환경설정

API, 소켓, 로비 서버를 맡아 환경설정을 했습니다.

- build를 위해 application.properties 파일에 환경변수를 설정했습니다.
- lobby서버에서 redis를 사용하고 이는 현재 docker위에서 동작합니다.

---

### 게임방 생성

**기본정보**

1. 게임 방을 생성하는 API 입니다. 해당 API를 통해 게임방이 생성됩니다.
2. 게임방의 정보는 로비서버에 저장되고 또한 게임방을 생성한 플레이어는 방장 자격을 부여받습니다.
3. 해당 연결 이전 웹소켓의 연결이 필요합니다.
- info — json에 들어갈 필드를 설명합니다.
    - roomId — 상단에서 값을 받은 UUID(string) 값입니다.
    - roomName — 사용자가 방을 생성할 때 입력하는 외부에 보이는 방의 이름 값(string)입니다.
    - hostPlayerId — 방을 생성하는 플레이어의 PK 아이디 값(long)입니다.
    - isPrivate — 비밀방 여부를 나타내는 값(boolean) 입니다. 현재 비밀방 기능 구현 X
    - password — isPrivate가 true인 경우 설정하는 비밀번호 값(string)입니다.

---

### 게임방 입장

**기본정보**

1. 게임 방을 입장하는 API 입니다. 해당 API를 통해 특정 경로의 게임방에 플레이어가 속해있음을 인식하고 다른 기능들을 사용할 수 있습니다.
- info — json에 들어갈 필드를 설명합니다.
    - playerId — 플레이어의 PK ID(long) 값입니다.

---

### 게임방 퇴장

**기본정보**

1. 게임 방에서 퇴장하는 API 입니다. 해당 API를 통해 플레이어는 방에서 나갈 수 있습니다.
2. 방장이 게임에서 퇴장한 경우, 남은 유저 중 랜덤하게 방장 자격을 부여받습니다.
3. 모든 유저가 방에서 퇴장한 경우 방의 정보는 DB(Redis)에서 삭제됩니다.
4. 게임 방 퇴장 시에 웹소켓 연결도 반드시 disconnect 해야합니다.
- info — json에 들어갈 필드를 설명합니다.
    - playerId — 플레이어의 PK ID(long) 값입니다.

---

### 게임방 전체 조회

**기본정보**

1. 게임방을 조회하는 API 입니다. 해당 API를 통해 플레이어는 방의 목록을 확인할 수 있습니다.
2. 방은 최신순으로 정렬하여 보여집니다.
3. 모든 유저가 방에서 퇴장한 경우 방의 정보는 DB(Redis)에서 삭제되어 반환되지 않습니다.
4. page번호와 size 파라미터를 통해 pagination된 목록을 받을 수 있습니다.
- info — 파라미터에 들어갈 필드를 설명합니다.
    - page — 페이지의 번호 값입니다. 시작은 0부터이지만, 요청 시 변경하겠습니다.
    - size — 한 페이지의 크기 값입니다. UI에 맞게 조절해서 사용하면 됩니다.

---

**[학습 내용]**

[학습 내용 정리 링크](https://www.notion.so/9372dc9458b2405492ff7a754cdfe17a?pvs=21)

<br />
<br />



## Infra - 이지원

- certbot을 활용하여 SSL/TLS 인증서를 발급받은 후 HTTPS 적용 완료
- docker-compose를 활용하여 도커 컨테이너 관리 설정 완료
- Docker Hub을 이용하여 CI를 구축하는 방식에 대해서 학습함
    - Docker Hub을 활용하면 CI 구축을 수월하게 할 수 있지만, 프로젝트가 public으로만 생성할 수 있기 때문에 설정 파일에 보안상 민감한 정보가 포함될 경우 좋지 않음
    - 이에 따라, Docker Image 중에서 registry를 사용하여 EC2 서버에 개인 Docker Hub와 같은 것을 사용할 수 있음
- BE API 프로젝트를 Docker Hub을 이용하여 CI를 구축하려고 시도하였지만 실패함
    - BE API 프로젝트가 다른 BE 프로젝트와 연결된 코드가 많아서 단독으로 배포하기 힘듦
        
        → 단독으로 배포할 수 있는 BE AUTH 프로젝트를 먼저 배포함으로써 Docker Hub을 이용한 CI 구축 방식에 대해서 검증 후 차후 다른 프로젝트에 적용하는 방안으로 방향을 바꿈
        
- BE AUTH 프로젝트를 Docker Hub를 이용하여 CI를 구축하려고 시도하였지만 실패함
    - BE AUTH 프로젝트 이미지 생성까지 정상적으로 완료하였지만 EC2 서버에 있는 개인 Docker Hub와 통신 못하는 문제 발생
        
        → 코치님께서 nginx 설정이 잘못된 것 같다는 피드백을 받음
        
    - nginx 설정을 수정해서 문제를 해결하려고 시도했지만 실패
        
        → 해당 방식 대신 Jenkins와 EC2 간에 공유 볼륨을 설정하여 거기서 빌드 후 배포하는 방식으로 바꿀 예정
        
<br />

## 데이터 - 이지원

- LangChain과 Ollama를 활용하여 gemma2 모델을 이용하여 작물 기사 생성 기능 구현 완료
- LLM 모델 특성상 결과 형식이 일정하지 않아서 결과 파싱하는 과정에서 오류가 자주 발생
    
    → LangChain의 Output Parser를 이용하여 결과 검증 후 파싱하는 방식 적용
    
- LangChain의 Output Parser를 이용하여 결과 검증하여 실패한 경우 다시 시도하여 결과 파싱하는 과정에서 오류가 발생하여 프로그램이 중단되는 경우 없앰
- 작물 기사 생성 시 prompt 메세지에 “감자와 관련된 기사를 생성해줘”와 같이 작물만 제시하면 건강과 기술에 대해서만 기사를 생성함
    
    → 데이터의 다양성이 떨어짐. 이에 다음과 같이 prompt를 수정해나감
    
    - “감자와 관련된 경제 관점에서 기사를 생성해줘”와 같이 작물 + 관점으로 생성 요청함
        
        → 다양한 관점에서 기사를 생성하지만, 겹치는 내용이 많아짐
        
- 동일한 소재의 작물 기사를 생성하지 않도록 Redis에 대화 내용을 저장하여 gemma2 모델이 이전 대화 내용을 기억할 수 있게 함
    
    → 이전과 비교했을 때 데이터 다양성이 향상되었지만 여전히 기대에 못 미치는 성능
    
- “감자와 관련된 경제 관점에서 긍정적인 기사를 생성해줘”와 같이 기사 분위기에 대한 요구도 추가함
    
    → 아직도 기대에 못 미치는 성능
    
    ⇒ 경제 관점에 대해 설명을 추가하여 내가 원하는 관점이 무엇인지 정확히 알 수 있도록 함
    
    ∴ 데이터 다양성이 눈에 띄게 향상되는 성과를 얻음
    
- 결론적으로 gemma2 모델을 이용하여 작물 기사를 약 500개 생성함
- 차후, 게임에 재미 요소를 추가하기 위해서 ChatGPT API를 활용하여 판타지적 요소가 감미된 작물 기사를 생성할 예정
